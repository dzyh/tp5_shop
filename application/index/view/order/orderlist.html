<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>我的订单</title>
		<meta name="keywords" content="KEYWORDS..." />
		<meta name="description" content="DESCRIPTION..." />
		<meta name="author" content="DeathGhost" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name='apple-touch-fullscreen' content='yes'>
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<meta name="viewport" content="initial-scale=1, width=device-width, maximum-scale=1, user-scalable=no">
		<link rel="stylesheet" type="text/css" href="__STATIC__/index/css/reset.css">
		<link rel="stylesheet" type="text/css" href="__STATIC__/index/css/style.css" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="__STATIC__/index/css/swiper3.07.min.css" />
		<style>
			.tab {top: 0;}
			.my-order-iphone1 {margin-top: 4%;}
			.addclasstruenav{color: #3acd17;}
			
		</style>
	</head>

	<body class="padd_40">	
		<div class="tab">
			<a href="javascript:;" data-status="0"  class="active">待付款</a>
			<a href="javascript:;" data-status="1" >制作中</a>
			<a href="javascript:;" data-status="-1" >已取消</a>
			<a href="javascript:;" data-status="2" >已完成</a>
			<div class="clearfix"></div>
		</div>
		<div class="swiper-container" style="margin-top: -40px;" >
			<div class="refreshtip">下拉可以刷新</div>
			<div class="swiper-wrapper w">
				<div class="swiper-slide d">
					<div class="init-loading list-group-item text-center" style="display: none;">下拉可以刷新</div>
					<div class="swiper-container2">
						<div class="swiper-wrapper">
							<div class="swiper-slide list-group">
								<ul>
									{volist name="orderstatus0" id="vo"}
									<li class="bor-bottom5-f1 bg-fff padb03">
										<div class="order-details-header">
											<div class="order-det-logo fl"><img src="__STATIC__/index/img/logo.jpg"></div>
											<div class="order-det-time fl">
												<h4>{$syssets['title']}</h4>
												<p>{$vo.createtime|date="Y-m-d",###}</p>
											</div>
											<div class="my-order-iphone1 fr f032 text-right">
												<h4 class="f029">￥{$vo.price}</h4>
												<p class="f02 color999">订单号：{$vo.ordersn}</p>
											</div>
											<div class="clearfix"></div>
										</div>
										<div class="commodity-name f032">
											<ul>
												<li>
													{:goodsData($vo.goodsdata)}
												</li>
												
												<div class="clearfix"></div>
											</ul>
										</div>
										<div class="bg-fff pay-button-myorder">
											<button class="bg99 cancel" data-ordersn="{$vo.ordersn}">取消</button>
											<button class="bg26c400"><a href="{:url('order/create')}?ordersn={$vo.ordersn}" style="color: #fff">去付款</a></button>
										</div>
									</li>
									{/volist}
								</ul>

							</div>
							
							<div class="swiper-slide list-group">
								<ul>
									{volist name="orderstatus1" id="vo"}
									<li class="bor-bottom5-f1 bg-fff">
										<div class="order-details-header">
											<div class="order-det-logo fl"><img src="__STATIC__/index/img/logo.jpg"></div>
											<div class="order-det-time fl">
												<h4>总店</h4>
												<p>{$vo.createtime|date="Y-m-d",###}</p>
											</div>
											<div class="my-order-iphone1 fr f032 text-right">
												<h4 class="f029">￥{$vo.price}</h4>
												<p class="f02 color999">订单号：{$vo.ordersn}</p>
											</div>
											<div class="clearfix"></div>
										</div>
										<div class="commodity-name f032">
											<ul>
												<li>
													{:goodsData($vo.goodsdata)}
												</li>
												
												<div class="clearfix"></div>
											</ul>
										</div>
										<div class="bg-fff pay-button-myorder">
											<button class="bgf58d05">制作中</button>
										</div>
									</li>
									{/volist}
								</ul>
							</div>
							<div class="swiper-slide list-group">
								<ul>
									{volist name="orderstatus_1" id="vo"}
									<li class="bor-bottom5-f1 bg-fff">
										<div class="order-details-header">
											<div class="order-det-logo fl"><img src="__STATIC__/index/img/logo.jpg"></div>
											<div class="order-det-time fl">
												<h4>总店</h4>
												<p>{$vo.createtime|date="Y-m-d",###}</p>
											</div>
											<div class="my-order-iphone1 fr f032 text-right">
												<h4 class="f029">￥{$vo.price}</h4>
												<p class="f02 color999">订单号：{$vo.ordersn}</p>
											</div>
											<div class="clearfix"></div>
										</div>
										<div class="commodity-name f032">
											<ul>
												<li>
													{:goodsData($vo.goodsdata)}
												</li>
												
												<div class="clearfix"></div>
											</ul>
										</div>
										<div class="bg-fff pay-button-myorder">
											<button class="bg99" >已取消</button>
										</div>
									</li>
									{/volist}
								</ul>
							</div>
							<div class="swiper-slide list-group">
								<ul>
									{volist name="orderstatus2" id="vo"}
									<li class="bor-bottom5-f1 bg-fff">
										<div class="order-details-header">
											<div class="order-det-logo fl"><img src="__STATIC__/index/img/logo.jpg"></div>
											<div class="order-det-time fl">
												<h4>总店</h4>
												<p>{$vo.createtime|date="Y-m-d",###}</p>
											</div>
											<div class="my-order-iphone1 fr f032 text-right">
												<h4 class="f029">￥{$vo.price}</h4>
												<p class="f02 color999">订单号：{$vo.ordersn}</p>
											</div>
											<div class="clearfix"></div>
										</div>
										<div class="commodity-name f032">
											<ul>
												<li>
													{:goodsData($vo.goodsdata)}
												</li>
												
												<div class="clearfix"></div>
											</ul>
										</div>
										<div class="bg-fff pay-button-myorder">
											<button class="bg26c400">已完成</button>
										</div>
									</li>	
									{/volist}								
								</ul>
							</div>

						</div>
					</div>
				</div>
			</div>

			<div class="loadtip">我是有底线的</div>
			<div class="swiper-scrollbar"></div>
		</div>
		{include file="public/footer"}
		<script src="__STATIC__/index/js/jquery.js" type="text/javascript" charset="utf-8"></script>
    	<script type="text/javascript" src="__STATIC__/admin/lib/layer/2.4/layer.js"></script>
		<script src="__STATIC__/index/js/swiper.jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(document).ready(function(){
			  $(".toggleButton").click(function(){
			  $(".toggleCon").toggle(1000);
			  });
			  $(".cancel").click(function (){
			  		var ordersn = $(this).attr('data-ordersn')
					layer.confirm('确定取消吗?', {icon: 3, title:'提示'}, function(index){
						$.post('{:url('order/cancel')}',{'ordersn':ordersn},function(res){
			                if(res.error)
			                {
			                    layer.msg(res.msg);
			                }else{
			                    layer.msg(res.msg,function(){
			                        location.href = res.url;
			                    });
			                }
			                
			            })
					});
				})
			});
		</script>
		
		
		
		
		<script type="text/javascript">
			var loadFlag = true;
			var oi = 0;
			var mySwiper = new Swiper('.swiper-container', {
				direction: 'vertical',
				scrollbar: '.swiper-scrollbar',
				slidesPerView: 'auto',
				mousewheelControl: true,
				freeMode: true,
				onTouchMove: function(swiper) { //手动滑动中触发
					var _viewHeight = document.getElementsByClassName('swiper-wrapper')[0].offsetHeight;
					var _contentHeight = document.getElementsByClassName('swiper-slide')[0].offsetHeight;

					if(mySwiper.translate < 50 && mySwiper.translate > 0) {
						$(".init-loading").html('下拉刷新...').show();
					} else if(mySwiper.translate > 50) {
						$(".init-loading").html('释放刷新...').show();
					}
				},
				onTouchEnd: function(swiper) {
					/*console.log($('.active').attr('data-status'))
					var _viewHeight = document.getElementsByClassName('swiper-wrapper')[0].offsetHeight;
					var _contentHeight = document.getElementsByClassName('swiper-slide')[0].offsetHeight;
					// 上拉加载
					if(mySwiper.translate <= _viewHeight - _contentHeight - 50 && mySwiper.translate < 0) {
						// console.log("已经到达底部！");

						if(loadFlag) {
							$(".loadtip").html('正在加载...');
						} else {
							$(".loadtip").html('没有更多啦！');
						}

						setTimeout(function() {
							for(var i = 0; i < 5; i++) {
								oi++;
								$(".list-group").eq(mySwiper2.activeIndex).append('<li class="bor-bottom5-f1 bg-fff padb03"><div class="order-details-header"><div class="order-det-logo fl"><img src="__STATIC__/index/img/logo.jpg"></div><div class="order-det-time fl"><h4>合肥南站店</h4><p>2017-10-12</p></div><div class="my-order-iphone1 fr f032 text-right"><h4 class="f029">￥24.50</h4><p class="f02 color999">订单号：20171012678</p></div><div class="clearfix"></div></div><div class="commodity-name f032"><ul><li><span>商品名称1<em>×</em>2</span>+<span>商品名称1<em>×</em>2</span><span>商品名称1<em>×</em>2</span>+<span>商品名称1<em>×</em>2</span></li><div class="clearfix"></div></ul></div><div class="bg-fff pay-button-myorder"><button class="bg99">取消</button><button class="bg26c400" >去付款（还剩3分钟00秒）</button></div></li>');
							}
							$(".loadtip").html('上拉加载更多...');
							mySwiper.update(); // 重新计算高度;
						}, 800);
					}*/

					// 下拉刷新
					if(mySwiper.translate >= 50) {
						$(".init-loading").html('正在刷新...').show();
						$(".loadtip").html('上拉加载更多');
						loadFlag = true;

						setTimeout(function() {
							$(".refreshtip").show(0);
							$(".init-loading").html('刷新成功！');
							setTimeout(function() {
								//$(".init-loading").html('').hide();
								location.reload();
							}, 800);
							$(".loadtip").show(0);

							//刷新操作
							mySwiper.update(); // 重新计算高度;
						}, 1000);
					} else if(mySwiper.translate >= 0 && mySwiper.translate < 50) {
						$(".init-loading").html('').hide();
					}
					return false;
				}
			});
			var mySwiper2 = new Swiper('.swiper-container2', {
				onTransitionEnd: function(swiper) {

					$('.w').css('transform', 'translate3d(0px, 0px, 0px)')
					$('.swiper-container2 .swiper-slide-active').css('height', 'auto').siblings('.swiper-slide').css('height', '0px');
					mySwiper.update();

					$('.tab a').eq(mySwiper2.activeIndex).addClass('active').siblings('a').removeClass('active');
				}

			});
			$('.tab a').click(function() {

				$(this).addClass('active').siblings('a').removeClass('active');
				mySwiper2.slideTo($(this).index(), 500, false)

				$('.w').css('transform', 'translate3d(0px, 0px, 0px)')
				$('.swiper-container2 .swiper-slide-active').css('height', 'auto').siblings('.swiper-slide').css('height', '0px');
				mySwiper.update();
			});
		</script>
	</body>

</html>